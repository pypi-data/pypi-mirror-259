syntax = "proto3";

package komodo;

// Komodo Appliances
// protoc -I. --python_out=. --pyi_out=. ./model.proto

message User {
    string guid = 1;
    string email = 2;
    string name = 3;
    map<string, string> conversations = 4; // agent_guid -> conversation_guid
}

message Appliance {
    string guid = 1;
    string name = 2;
    string purpose = 3;
    repeated Agent agents = 4;
    repeated Tool tools = 5;
    repeated DataSource data_sources = 6;
    repeated VectorStore vector_stores = 7;
}

message Agent {
    string guid = 1;
    string name = 2;
    string purpose = 3;
    string email = 4;
    string reply_as = 5;
    string phone = 6;
    repeated Behavior behaviors = 7;
    repeated Tool tools = 8;
}

enum Mode {
    MODE_UNSPECIFIED = 0;
    MODE_CONVERSATION = 1;
    MODE_CHATBOT = 2;
    MODE_EMAIL = 3;
    MODE_PHONE = 4;
    MODE_API = 5;
}

message Behavior {
    Mode mode = 1;
    string text = 2;
    string model = 7;
    string provider = 8;
    string assistant_id = 9;
    string output_format = 11;
    string footer = 12;
}

message Tool {
    string guid = 1;
    string name = 2;
    string purpose = 3;
    string definition = 4;
}

message Conversation {
    string guid = 1;
    string title = 2;
    string created_at = 3;
    string user_guid = 4;
    string agent_guid = 5;
    Mode mode = 6;
    repeated Message messages = 7;
}

message Message {
    enum Sender {
        UNSPECIFIED = 0;
        USER = 1;
        AGENT = 2;
    }

    string guid = 1;
    Sender sender = 2;
    string text = 3;
    string created_at = 4;
}

message DataSource {
    enum Type {
        UNSPECIFIED = 0;
        FILESYSTEM = 1;
        WEBPAGE = 2;
        WEBSITE = 3;
        S3 = 4;
        DATABASE = 5;
        API = 6;
    }

    string name = 1;
    Type type = 2;
    oneof source {
        Filesystem filesystem = 3;
        Webpage webpage = 4;
        Website website = 5;
        S3 s3 = 6;
        Database database = 7;
        Api api = 8;
    }
}

message Filesystem {
    string path = 1;
}

message Webpage {
    string url = 1;
}

message Website {
    string url = 1;
    int32 depth = 2;
}

message S3 {
    string bucket = 1;
    string key = 2;
}

message Database {
    string host = 1;
    string port = 2;
    string database = 3;
    string username = 4;
    string password = 5;
    string table = 6;
}

message Api {
    string url = 1;
    string username = 2;
    string password = 3;
}


message VectorStore {
    enum Type {
        UNSPECIFIED = 0;
        PINECONE = 1;
        QDRANT = 2;
    }

    string name = 1;
    string type = 2;
    string index = 3;
    oneof store {
        PineconeIndex pinecone = 4;
        QdrantCollection qdrant = 5;
    }
}

message PineconeIndex {
    string name = 1;
    int32 dimension = 2;
    string metric = 3;
}

message QdrantCollection {
    string name = 1;
    string location = 2;
    string url = 3;
    int32 port = 4;
    int32 dimension = 5;
    string metric = 6;
}
