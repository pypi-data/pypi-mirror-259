export const id=56852;export const ids=[56852];export const modules={59216:(e,t,s)=>{s.d(t,{Q:()=>a,o:()=>c});var n=s(62412),o=s(53616),r=s(93408);const i=(e,t,s,r)=>{const i=s((0,n.c)(e,t),r);return i instanceof Date?(0,o.c)(i,t):i},c=(e,t,s,n,o)=>s.time_zone===r.KU.server?i(e,n.time_zone,t,o):t(e,o),a=(e,t,s,n,o)=>s.time_zone===r.KU.server?i(e,n.time_zone,t,o):t(e,o)},69832:(e,t,s)=>{s.d(t,{a:()=>n});const n=(e,t)=>{const s={};for(const n of e){const e=t(n);e in s?s[e].push(n):s[e]=[n]}return s}},21612:(e,t,s)=>{s.d(t,{CA:()=>r,MX:()=>c,O2:()=>_,OQ:()=>l,Qv:()=>y,UB:()=>a,Up:()=>n,WA:()=>i,aA:()=>f,cf:()=>u,qg:()=>o});const n=33524==s.j?["migration_error","setup_error","setup_retry"]:null,o=33524==s.j?["not_loaded","loaded","setup_error","setup_retry"]:null,r=(e,t,s)=>{const n={type:"config_entries/subscribe"};return s&&s.type&&(n.type_filter=s.type),e.connection.subscribeMessage((e=>t(e)),n)},i=(e,t)=>{const s={};return t&&(t.type&&(s.type_filter=t.type),t.domain&&(s.domain=t.domain)),e.callWS({type:"config_entries/get",...s})},c=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),a=(e,t,s)=>e.callWS({type:"config_entries/update",entry_id:t,...s}),l=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),u=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),_=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),f=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),y=(e,t)=>{const s=[...e],n=e=>{const s=t[e.domain];return"helper"===(null==s?void 0:s.integration_type)?-1:1};return s.sort(((e,t)=>n(t)-n(e)))}},71132:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{C0:()=>E,CQ:()=>C,Ce:()=>z,GG:()=>L,Kc:()=>T,QB:()=>w,QZ:()=>S,SG:()=>$,SK:()=>B,au:()=>P,gT:()=>U,gZ:()=>W,im:()=>O,oP:()=>A,q0:()=>D,sn:()=>G,uV:()=>q,uY:()=>x,us:()=>Q});var o=s(40569),r=s(67696),i=s(58580),c=s(54468),a=s(1168),l=s(85580),u=s(20392),_=s(91984),f=s(29880),y=s(31656),d=s(52160),g=s(59216),p=s(98611),h=s(69832),m=s(21612),b=s(32012),v=e([p]);p=(v.then?(await v)():v)[0];const k=[],w=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),S=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),T=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),W=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),C=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),P=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),D=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),E=e=>e.callWS({type:"energy/info"}),q=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),Q=e=>e.callWS({type:"energy/get_prefs"}),U=async(e,t)=>{const s=e.callWS({type:"energy/save_prefs",...t});return M(e),s},H=async(e,t,s,n,o,r="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==o?void 0:o.toISOString(),energy_statistic_ids:s,co2_statistic_id:n,period:r}),O=e=>(0,h.a)(e.energy_sources,(e=>e.type)),A=(e,t,s)=>{const n=[];for(const o of e.energy_sources)if(!s||s.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const e of o.flow_from){n.push(e.stat_energy_from),e.stat_cost&&n.push(e.stat_cost);const s=t.cost_sensors[e.stat_energy_from];s&&n.push(s)}for(const e of o.flow_to){n.push(e.stat_energy_to),e.stat_compensation&&n.push(e.stat_compensation);const s=t.cost_sensors[e.stat_energy_to];s&&n.push(s)}}else n.push(o.stat_energy_from),n.push(o.stat_energy_to);else{n.push(o.stat_energy_from),o.stat_cost&&n.push(o.stat_cost);const e=t.cost_sensors[o.stat_energy_from];e&&n.push(e)}else n.push(o.stat_energy_from);return n},K=async(e,t,s,n,_)=>{const[f,y]=await Promise.all([(0,m.WA)(e,{domain:"co2signal"}),E(e)]),d=f.length?f[0]:void 0;let p;if(d)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const s=e.states[t.entity_id];if(s&&"%"===s.attributes.unit_of_measurement){p=s.entity_id;break}}const h=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)h.push(t.stat_energy_from);const v=A(t,y,["grid","solar","battery","gas"]),k=A(t,y,["water"]),w=[...v,...k],S=(0,o.c)(n||new Date,s),T=S>35?"month":S>2?"day":"hour",W=e.config.unit_system.length||"",C={energy:"kWh",volume:"km"===W?"m続":"ft続"},P={volume:"km"===W?"L":"gal"},D=v.length?(0,b.WU)(e,s,n,v,T,C,["change"]):{},q=k.length?(0,b.WU)(e,s,n,k,T,P,["change"]):{};let Q,U,O,K,M,j={},x={};_&&(U=(0,g.Q)(s,r.c,e.locale,e.config)&&(0,g.Q)(n||new Date,i.c,e.locale,e.config)?(0,g.o)(s,c.c,e.locale,e.config,-(0,g.Q)(n||new Date,a.c,e.locale,e.config,s)-1):(0,g.o)(s,l.c,e.locale,e.config,-1*(S+1)),O=(0,u.c)(s,-1),v.length&&(j=(0,b.WU)(e,U,O,v,T,C,["change"])),k.length&&(x=(0,b.WU)(e,U,O,k,T,P,["change"]))),void 0!==p&&(K=H(e,s,h,p,n,S>35?"month":S>2?"day":"hour"),_&&(M=H(e,U,h,p,O,S>35?"month":S>2?"day":"hour")));const z={},R=w.length?(0,b.kH)(e,w):[],[B,G,L,$,I,Z,F]=await Promise.all([D,q,j,x,R,K,M]),V={...B,...G};_&&(Q={...L,...$}),w.length&&I.forEach((e=>{z[e.statistic_id]=e}));return{start:s,end:n,startCompare:U,endCompare:O,info:y,prefs:t,stats:V,statsMetadata:z,statsCompare:Q,co2SignalConfigEntry:d,co2SignalEntity:p,fossilEnergyConsumption:Z,fossilEnergyConsumptionCompare:F}},M=e=>{k.forEach((t=>{const s=x(e,{key:t});s.clearPrefs(),s._active&&s.refresh()}))},j=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},x=(e,t={})=>{let s="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");s=`_${t.key}`}if(e.connection[s])return e.connection[s];k.push(t.key);const n=(0,d.S)(e.connection,s,(async()=>(n.prefs||(n.prefs=await Q(e)),j(n),K(e,n.prefs,n.start,n.end,n.compare)))),o=n.subscribe;n.subscribe=e=>{const t=o(e);return n._active++,void 0===n._refreshTimeout&&j(n),()=>{n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),t()}},n._active=0,n.prefs=t.prefs;const r=new Date,i=(0,p.O)(r,e.locale,e.config).split(":")[0];n.start=(0,g.o)("0"===i?(0,l.c)(r,-1):r,_.c,e.locale,e.config),n.end=(0,g.o)("0"===i?(0,l.c)(r,-1):r,f.c,e.locale,e.config);const c=()=>{n._updatePeriodTimeout=window.setTimeout((()=>{n.start=(0,g.o)(new Date,_.c,e.locale,e.config),n.end=(0,g.o)(new Date,f.c,e.locale,e.config),c()}),(0,y.c)((0,g.o)(r,f.c,e.locale,e.config),1).getTime()-Date.now())};return c(),n.clearPrefs=()=>{n.prefs=void 0},n.setPeriod=(t,s)=>{var o;n.start=t,n.end=s,n.start.getTime()!==(0,g.o)(new Date,_.c,e.locale,e.config).getTime()||(null===(o=n.end)||void 0===o?void 0:o.getTime())!==(0,g.o)(new Date,f.c,e.locale,e.config).getTime()||n._updatePeriodTimeout?n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0):c()},n.setCompare=e=>{n.compare=e},n},z=e=>e.callWS({type:"energy/solar_forecast"}),R=["volume","energy"],B=(e,t={},s)=>{for(const n of e.energy_sources){if("gas"!==n.type)continue;if(s&&s===n.stat_energy_from)continue;const e=t[n.stat_energy_from];if(R.includes(null==e?void 0:e.unit_class))return e.unit_class}},G=(e,t,s={})=>{const n=B(t,s);if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},L=e=>"km"===e.config.unit_system.length?"L":"gal",$="/docs/energy/faq/#troubleshooting-missing-entities";n()}catch(e){n(e)}}))},81540:(e,t,s)=>{s.d(t,{K:()=>c});var n=s(5576),o=s(37668),r=s(54915),i=s(55736);const c=e=>(0,n.c)(null,(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,i.qq)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,o.c)((0,r.c)(s.prototype),"connectedCallback",this).call(this),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,o.c)((0,r.c)(s.prototype),"disconnectedCallback",this).call(this),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,o.c)((0,r.c)(s.prototype),"updated",this).call(this,e),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this.__checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}]}}),e)}};
//# sourceMappingURL=56852.7iHNTp-gWnY.js.map