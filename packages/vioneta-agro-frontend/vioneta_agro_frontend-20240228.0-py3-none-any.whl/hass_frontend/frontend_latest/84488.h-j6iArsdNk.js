export const id=84488;export const ids=[84488];export const modules={85580:(e,t,r)=>{r.d(t,{c:()=>a});var n=r(41280),o=r(77884),s=r(37032);function a(e,t){(0,s.c)(2,arguments);var r=(0,o.c)(e),a=(0,n.c)(t);return isNaN(a)?new Date(NaN):a?(r.setDate(r.getDate()+a),r):r}},31656:(e,t,r)=>{r.d(t,{c:()=>c});var n=r(41280),o=r(20392),s=r(37032),a=36e5;function c(e,t){(0,s.c)(2,arguments);var r=(0,n.c)(t);return(0,o.c)(e,r*a)}},20392:(e,t,r)=>{r.d(t,{c:()=>a});var n=r(41280),o=r(77884),s=r(37032);function a(e,t){(0,s.c)(2,arguments);var r=(0,o.c)(e).getTime(),a=(0,n.c)(t);return new Date(r+a)}},54468:(e,t,r)=>{r.d(t,{c:()=>a});var n=r(41280),o=r(77884),s=r(37032);function a(e,t){(0,s.c)(2,arguments);var r=(0,o.c)(e),a=(0,n.c)(t);if(isNaN(a))return new Date(NaN);if(!a)return r;var c=r.getDate(),i=new Date(r.getTime());return i.setMonth(r.getMonth()+a+1,0),c>=i.getDate()?i:(r.setFullYear(i.getFullYear(),i.getMonth(),c),r)}},39756:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(77884),o=r(37032);function s(e,t){(0,o.c)(2,arguments);var r=(0,n.c)(e),s=(0,n.c)(t),a=r.getTime()-s.getTime();return a<0?-1:a>0?1:a}},1168:(e,t,r)=>{r.d(t,{c:()=>c});var n=r(77884),o=r(37032);var s=r(39756),a=r(58580);function c(e,t){(0,o.c)(2,arguments);var r,c=(0,n.c)(e),i=(0,n.c)(t),l=(0,s.c)(c,i),g=Math.abs(function(e,t){(0,o.c)(2,arguments);var r=(0,n.c)(e),s=(0,n.c)(t);return 12*(r.getFullYear()-s.getFullYear())+(r.getMonth()-s.getMonth())}(c,i));if(g<1)r=0;else{1===c.getMonth()&&c.getDate()>27&&c.setDate(30),c.setMonth(c.getMonth()-l*g);var u=(0,s.c)(c,i)===-l;(0,a.c)((0,n.c)(e))&&1===g&&1===(0,s.c)(e,i)&&(u=!1),r=l*(g-Number(u))}return 0===r?0:r}},29880:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(77884),o=r(37032);function s(e){(0,o.c)(1,arguments);var t=(0,n.c)(e);return t.setHours(23,59,59,999),t}},45248:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(77884),o=r(37032);function s(e){(0,o.c)(1,arguments);var t=(0,n.c)(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}},67696:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(77884),o=r(37032);function s(e){return(0,o.c)(1,arguments),1===(0,n.c)(e).getDate()}},58580:(e,t,r)=>{r.d(t,{c:()=>c});var n=r(77884),o=r(29880),s=r(45248),a=r(37032);function c(e){(0,a.c)(1,arguments);var t=(0,n.c)(e);return(0,o.c)(t).getTime()===(0,s.c)(t).getTime()}},59216:(e,t,r)=>{r.d(t,{Q:()=>i,o:()=>c});var n=r(62412),o=r(53616),s=r(93408);const a=(e,t,r,s)=>{const a=r((0,n.c)(e,t),s);return a instanceof Date?(0,o.c)(a,t):a},c=(e,t,r,n,o)=>r.time_zone===s.KU.server?a(e,n.time_zone,t,o):t(e,o),i=(e,t,r,n,o)=>r.time_zone===s.KU.server?a(e,n.time_zone,t,o):t(e,o)},69832:(e,t,r)=>{r.d(t,{a:()=>n});const n=(e,t)=>{const r={};for(const n of e){const e=t(n);e in r?r[e].push(n):r[e]=[n]}return r}},21612:(e,t,r)=>{r.d(t,{CA:()=>s,MX:()=>c,O2:()=>u,OQ:()=>l,Qv:()=>_,UB:()=>i,Up:()=>n,WA:()=>a,aA:()=>y,cf:()=>g,qg:()=>o});const n=33524==r.j?["migration_error","setup_error","setup_retry"]:null,o=33524==r.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(e,t,r)=>{const n={type:"config_entries/subscribe"};return r&&r.type&&(n.type_filter=r.type),e.connection.subscribeMessage((e=>t(e)),n)},a=(e,t)=>{const r={};return t&&(t.type&&(r.type_filter=t.type),t.domain&&(r.domain=t.domain)),e.callWS({type:"config_entries/get",...r})},c=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),i=(e,t,r)=>e.callWS({type:"config_entries/update",entry_id:t,...r}),l=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),g=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),u=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),y=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),_=(e,t)=>{const r=[...e],n=e=>{const r=t[e.domain];return"helper"===(null==r?void 0:r.integration_type)?-1:1};return r.sort(((e,t)=>n(t)-n(e)))}},71132:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.d(t,{C0:()=>z,CQ:()=>W,Ce:()=>K,GG:()=>q,Kc:()=>D,QB:()=>T,QZ:()=>k,SG:()=>B,SK:()=>j,au:()=>M,gT:()=>N,gZ:()=>S,im:()=>F,oP:()=>U,q0:()=>P,sn:()=>$,uV:()=>C,uY:()=>H,us:()=>E});var o=r(40569),s=r(67696),a=r(58580),c=r(54468),i=r(1168),l=r(85580),g=r(20392),u=r(91984),y=r(29880),_=r(31656),d=r(52160),p=r(59216),f=r(98611),m=r(69832),h=r(21612),v=r(32012),w=e([f]);f=(w.then?(await w)():w)[0];const b=[],T=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),D=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),S=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),W=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),M=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),z=e=>e.callWS({type:"energy/info"}),C=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),E=e=>e.callWS({type:"energy/get_prefs"}),N=async(e,t)=>{const r=e.callWS({type:"energy/save_prefs",...t});return A(e),r},Q=async(e,t,r,n,o,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==o?void 0:o.toISOString(),energy_statistic_ids:r,co2_statistic_id:n,period:s}),F=e=>(0,m.a)(e.energy_sources,(e=>e.type)),U=(e,t,r)=>{const n=[];for(const o of e.energy_sources)if(!r||r.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const e of o.flow_from){n.push(e.stat_energy_from),e.stat_cost&&n.push(e.stat_cost);const r=t.cost_sensors[e.stat_energy_from];r&&n.push(r)}for(const e of o.flow_to){n.push(e.stat_energy_to),e.stat_compensation&&n.push(e.stat_compensation);const r=t.cost_sensors[e.stat_energy_to];r&&n.push(r)}}else n.push(o.stat_energy_from),n.push(o.stat_energy_to);else{n.push(o.stat_energy_from),o.stat_cost&&n.push(o.stat_cost);const e=t.cost_sensors[o.stat_energy_from];e&&n.push(e)}else n.push(o.stat_energy_from);return n},Y=async(e,t,r,n,u)=>{const[y,_]=await Promise.all([(0,h.WA)(e,{domain:"co2signal"}),z(e)]),d=y.length?y[0]:void 0;let f;if(d)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const r=e.states[t.entity_id];if(r&&"%"===r.attributes.unit_of_measurement){f=r.entity_id;break}}const m=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)m.push(t.stat_energy_from);const w=U(t,_,["grid","solar","battery","gas"]),b=U(t,_,["water"]),T=[...w,...b],k=(0,o.c)(n||new Date,r),D=k>35?"month":k>2?"day":"hour",S=e.config.unit_system.length||"",W={energy:"kWh",volume:"km"===S?"m続":"ft続"},M={volume:"km"===S?"L":"gal"},P=w.length?(0,v.WU)(e,r,n,w,D,W,["change"]):{},C=b.length?(0,v.WU)(e,r,n,b,D,M,["change"]):{};let E,N,F,Y,A,O={},H={};u&&(N=(0,p.Q)(r,s.c,e.locale,e.config)&&(0,p.Q)(n||new Date,a.c,e.locale,e.config)?(0,p.o)(r,c.c,e.locale,e.config,-(0,p.Q)(n||new Date,i.c,e.locale,e.config,r)-1):(0,p.o)(r,l.c,e.locale,e.config,-1*(k+1)),F=(0,g.c)(r,-1),w.length&&(O=(0,v.WU)(e,N,F,w,D,W,["change"])),b.length&&(H=(0,v.WU)(e,N,F,b,D,M,["change"]))),void 0!==f&&(Y=Q(e,r,m,f,n,k>35?"month":k>2?"day":"hour"),u&&(A=Q(e,N,m,f,F,k>35?"month":k>2?"day":"hour")));const K={},x=T.length?(0,v.kH)(e,T):[],[j,$,q,B,G,L,Z]=await Promise.all([P,C,O,H,x,Y,A]),I={...j,...$};u&&(E={...q,...B}),T.length&&G.forEach((e=>{K[e.statistic_id]=e}));return{start:r,end:n,startCompare:N,endCompare:F,info:_,prefs:t,stats:I,statsMetadata:K,statsCompare:E,co2SignalConfigEntry:d,co2SignalEntity:f,fossilEnergyConsumption:L,fossilEnergyConsumptionCompare:Z}},A=e=>{b.forEach((t=>{const r=H(e,{key:t});r.clearPrefs(),r._active&&r.refresh()}))},O=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},H=(e,t={})=>{let r="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");r=`_${t.key}`}if(e.connection[r])return e.connection[r];b.push(t.key);const n=(0,d.S)(e.connection,r,(async()=>(n.prefs||(n.prefs=await E(e)),O(n),Y(e,n.prefs,n.start,n.end,n.compare)))),o=n.subscribe;n.subscribe=e=>{const t=o(e);return n._active++,void 0===n._refreshTimeout&&O(n),()=>{n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),t()}},n._active=0,n.prefs=t.prefs;const s=new Date,a=(0,f.O)(s,e.locale,e.config).split(":")[0];n.start=(0,p.o)("0"===a?(0,l.c)(s,-1):s,u.c,e.locale,e.config),n.end=(0,p.o)("0"===a?(0,l.c)(s,-1):s,y.c,e.locale,e.config);const c=()=>{n._updatePeriodTimeout=window.setTimeout((()=>{n.start=(0,p.o)(new Date,u.c,e.locale,e.config),n.end=(0,p.o)(new Date,y.c,e.locale,e.config),c()}),(0,_.c)((0,p.o)(s,y.c,e.locale,e.config),1).getTime()-Date.now())};return c(),n.clearPrefs=()=>{n.prefs=void 0},n.setPeriod=(t,r)=>{var o;n.start=t,n.end=r,n.start.getTime()!==(0,p.o)(new Date,u.c,e.locale,e.config).getTime()||(null===(o=n.end)||void 0===o?void 0:o.getTime())!==(0,p.o)(new Date,y.c,e.locale,e.config).getTime()||n._updatePeriodTimeout?n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0):c()},n.setCompare=e=>{n.compare=e},n},K=e=>e.callWS({type:"energy/solar_forecast"}),x=["volume","energy"],j=(e,t={},r)=>{for(const n of e.energy_sources){if("gas"!==n.type)continue;if(r&&r===n.stat_energy_from)continue;const e=t[n.stat_energy_from];if(x.includes(null==e?void 0:e.unit_class))return e.unit_class}},$=(e,t,r={})=>{const n=j(t,r);if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},q=e=>"km"===e.config.unit_system.length?"L":"gal",B="/docs/energy/faq/#troubleshooting-missing-entities";n()}catch(e){n(e)}}))},84488:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.r(t),r.d(t,{EnergyViewStrategy:()=>g});var o=r(5576),s=r(84244),a=r(55736),c=r(71132),i=e([c]);c=(i.then?(await i)():i)[0];const l=async()=>(await Promise.all([r.e(31900),r.e(39228)]).then(r.bind(r,39228)),{type:"panel",cards:[{type:"custom:energy-setup-wizard-card"}]});let g=(0,o.c)([(0,a.Kx)("energy-view-strategy")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"method",static:!0,key:"generate",value:async function(e,t){const r={cards:[]};let n;try{n=await(0,c.us)(t)}catch(e){return"not_found"===e.code?l():(r.cards.push({type:"markdown",content:`An error occurred while fetching your energy preferences: ${e.message}.`}),r)}r.type="sidebar";const o=n.energy_sources.find((e=>"grid"===e.type)),s=o&&o.flow_to.length,a=n.energy_sources.some((e=>"solar"===e.type)),i=n.energy_sources.some((e=>"gas"===e.type)),g=n.energy_sources.some((e=>"water"===e.type));return r.cards.push({type:"energy-compare",collection_key:"energy_dashboard"}),o&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_usage_graph_title"),type:"energy-usage-graph",collection_key:"energy_dashboard"}),a&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_solar_graph_title"),type:"energy-solar-graph",collection_key:"energy_dashboard"}),i&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_gas_graph_title"),type:"energy-gas-graph",collection_key:"energy_dashboard"}),g&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_water_graph_title"),type:"energy-water-graph",collection_key:"energy_dashboard"}),o&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_distribution_title"),type:"energy-distribution",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),(o||a)&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_sources_table_title"),type:"energy-sources-table",collection_key:"energy_dashboard"}),s&&r.cards.push({type:"energy-grid-neutrality-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),a&&s&&(r.cards.push({type:"energy-solar-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),r.cards.push({type:"energy-self-sufficiency-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"})),o&&r.cards.push({type:"energy-carbon-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),n.device_consumption.length&&r.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_graph_title"),type:"energy-devices-graph",collection_key:"energy_dashboard"}),r}}]}}),s.i6);n()}catch(e){n(e)}}))},53616:(e,t,r)=>{r.d(t,{c:()=>i});var n=r(92576),o=r(3732),s=r(27448),a=r(20889),c=r(88428);function i(e,t,r){if("string"==typeof e&&!e.match(s.c)){var i=n(r);return i.timeZone=t,(0,o.c)(e,i)}var l=(0,o.c)(e,r),g=(0,c.c)(l.getFullYear(),l.getMonth(),l.getDate(),l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()).getTime(),u=(0,a.c)(t,new Date(g));return new Date(g+u)}}};
//# sourceMappingURL=84488.h-j6iArsdNk.js.map