"use strict";(self.webpackChunkvioneta_agro_frontend=self.webpackChunkvioneta_agro_frontend||[]).push([[26368],{21164:function(e,t,r){r.d(t,{c:function(){return i}});r(78744),r(77612),r(23792),r(25896),r(81140);var a=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("".concat(e," is not a number"));return t};function i(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:a(e.substr(0,e.length-1))};var t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:a(t[0]),h:1}:{w:a(t[0]),h:a(t[1])}}catch(r){}return null}},59672:function(e,t,r){var a,i,n,s,o,c,d,l=r(95892),h=r(48328),u=r(76904),v=r(9160),p=r(45472),k=r(72696),f=r(88584),y=r(96440),m=r(19612),_=r(37668),g=r(54915),b=(r(40068),r(84244)),w=r(95548),x=r(70312),I=r(56552),E=r(2324),C=r(68324),q=(r(91244),r(63728),r(26560),r(53904),r(12568),r(10780),r(90360)),S=function(){var e=(0,h.c)((0,l.c)().mark((function e(t){return(0,l.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.callWS({type:"rtsp_to_webrtc/get_settings"}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r(61016),(0,m.c)([(0,w.Kx)("ha-web-rtc-player")],(function(e,t){var r,s,o=function(t){function r(){var t;(0,p.c)(this,r);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return t=(0,k.c)(this,r,[].concat(i)),e((0,f.c)(t)),t}return(0,y.c)(r,t),(0,v.c)(r)}(t);return{F:o,d:[{kind:"field",decorators:[(0,w.qq)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,w.qq)()],key:"entityid",value:void 0},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)()],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,w.K2)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,w.kt)("#remote-stream")],key:"_videoEl",value:void 0},{kind:"field",key:"_peerConnection",value:void 0},{kind:"field",key:"_remoteStream",value:void 0},{kind:"method",key:"render",value:function(){return this._error?(0,b.kP)(a||(a=(0,u.c)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,b.kP)(i||(i=(0,u.c)([' <video id="remote-stream" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" .poster="','" @loadeddata="','"></video> '])),this.autoPlay,this.muted,this.playsInline,this.controls,this.posterUrl,this._loadedData)}},{kind:"method",key:"connectedCallback",value:function(){(0,_.c)((0,g.c)(o.prototype),"connectedCallback",this).call(this),this.hasUpdated&&this._startWebRtc()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,_.c)((0,g.c)(o.prototype),"disconnectedCallback",this).call(this),this._cleanUp()}},{kind:"method",key:"updated",value:function(e){e.has("entityid")&&this._videoEl&&this._startWebRtc()}},{kind:"method",key:"_startWebRtc",value:(s=(0,h.c)((0,l.c)().mark((function e(){var t,r,a,i,n,s,o,c,d,u,v=this;return(0,l.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._error=void 0,e.next=3,this._fetchPeerConfiguration();case 3:return t=e.sent,(r=new RTCPeerConnection(t)).createDataChannel("dataSendChannel"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),a={offerToReceiveAudio:!0,offerToReceiveVideo:!0},e.next=11,r.createOffer(a);case 11:return i=e.sent,e.next=14,r.setLocalDescription(i);case 14:return n="",s=new Promise((function(e){r.addEventListener("icecandidate",function(){var t=(0,h.c)((0,l.c)().mark((function t(r){return(0,l.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.candidate){t.next=3;break}return e(),t.abrupt("return");case 3:n+="a=".concat(r.candidate.candidate,"\r\n");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})),e.next=18,s;case 18:return o=i.sdp+n,e.prev=19,e.next=22,(0,C.mw)(this.hass,this.entityid,o);case 22:c=e.sent,e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(19),this._error="Failed to start WebRTC stream: "+e.t0.message,r.close(),e.abrupt("return");case 30:return d=new MediaStream,r.addEventListener("track",(function(e){d.addTrack(e.track),v._videoEl.srcObject=d})),this._remoteStream=d,u=new RTCSessionDescription({type:"answer",sdp:c.answer}),e.prev=34,e.next=37,r.setRemoteDescription(u);case 37:e.next=44;break;case 39:return e.prev=39,e.t1=e.catch(34),this._error="Failed to connect WebRTC stream: "+e.t1.message,r.close(),e.abrupt("return");case 44:this._peerConnection=r;case 45:case"end":return e.stop()}}),e,this,[[19,25],[34,39]])}))),function(){return s.apply(this,arguments)})},{kind:"method",key:"_fetchPeerConfiguration",value:(r=(0,h.c)((0,l.c)().mark((function e(){var t;return(0,l.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,x.u)(this.hass,"rtsp_to_webrtc")){e.next=2;break}return e.abrupt("return",{});case 2:return e.next=4,S(this.hass);case 4:if((t=e.sent)&&t.stun_server){e.next=7;break}return e.abrupt("return",{});case 7:return e.abrupt("return",{iceServers:[{urls:["stun:".concat(t.stun_server)]}]});case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop()})),this._remoteStream=void 0),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection=void 0)}},{kind:"method",key:"_loadedData",value:function(){(0,q.O)(this,"load")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,b.gV)(n||(n=(0,u.c)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}"])))}}]}}),b.oH),(0,m.c)([(0,w.Kx)("ha-camera-stream")],(function(e,t){var r,a,i=function(t){function r(){var t;(0,p.c)(this,r);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return t=(0,k.c)(this,r,[].concat(i)),e((0,f.c)(t)),t}return(0,y.c)(r,t),(0,v.c)(r)}(t);return{F:i,d:[{kind:"field",decorators:[(0,w.qq)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,w.qq)({attribute:!1})],key:"stateObj",value:void 0},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,w.qq)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,w.K2)()],key:"_posterUrl",value:void 0},{kind:"field",decorators:[(0,w.K2)()],key:"_forceMJPEG",value:void 0},{kind:"field",decorators:[(0,w.K2)()],key:"_url",value:void 0},{kind:"field",decorators:[(0,w.K2)()],key:"_connected",value:function(){return!1}},{kind:"method",key:"willUpdate",value:function(e){var t;e.has("stateObj")&&!this._shouldRenderMJPEG&&this.stateObj&&(null===(t=e.get("stateObj"))||void 0===t?void 0:t.entity_id)!==this.stateObj.entity_id&&(this._getPosterUrl(),this.stateObj.attributes.frontend_stream_type===C.KS&&(this._forceMJPEG=void 0,this._url=void 0,this._getStreamUrl()))}},{kind:"method",key:"connectedCallback",value:function(){(0,_.c)((0,g.c)(i.prototype),"connectedCallback",this).call(this),this._connected=!0}},{kind:"method",key:"disconnectedCallback",value:function(){(0,_.c)((0,g.c)(i.prototype),"disconnectedCallback",this).call(this),this._connected=!1}},{kind:"method",key:"render",value:function(){return this.stateObj?this._shouldRenderMJPEG?(0,b.kP)(s||(s=(0,u.c)(['<img .src="','" .alt="','">'])),this._connected?(0,C.aq)(this.stateObj):"","Preview of the ".concat((0,I.W)(this.stateObj)," camera.")):this.stateObj.attributes.frontend_stream_type===C.KS?this._url?(0,b.kP)(o||(o=(0,u.c)(['<ha-hls-player autoplay playsinline .allowExoPlayer="','" .muted="','" .controls="','" .hass="','" .url="','" .posterUrl="','"></ha-hls-player>'])),this.allowExoPlayer,this.muted,this.controls,this.hass,this._url,this._posterUrl):b.qs:this.stateObj.attributes.frontend_stream_type===C.ag?(0,b.kP)(c||(c=(0,u.c)(['<ha-web-rtc-player autoplay playsinline .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','"></ha-web-rtc-player>'])),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl):b.qs:b.qs}},{kind:"get",key:"_shouldRenderMJPEG",value:function(){return this._forceMJPEG===this.stateObj.entity_id||(!(0,E.K)(this.stateObj,C.O_)||(this.stateObj.attributes.frontend_stream_type===C.ag?"undefined"==typeof RTCPeerConnection:!(0,x.u)(this.hass,"stream")))}},{kind:"method",key:"_getPosterUrl",value:(a=(0,h.c)((0,l.c)().mark((function e(){return(0,l.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,C.od)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 3:this._posterUrl=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this._posterUrl=void 0;case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{kind:"method",key:"_getStreamUrl",value:(r=(0,h.c)((0,l.c)().mark((function e(){var t,r;return(0,l.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,C.uz)(this.hass,this.stateObj.entity_id);case 3:t=e.sent,r=t.url,this._url=r,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),this._forceMJPEG=this.stateObj.entity_id;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return r.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,b.gV)(d||(d=(0,u.c)([":host,img{display:block}img{width:100%}"])))}}]}}),b.oH)},91244:function(e,t,r){var a,i,n,s,o=r(95892),c=r(48328),d=r(76904),l=r(9160),h=r(45472),u=r(72696),v=r(88584),p=r(96440),k=r(19612),f=r(37668),y=r(54915),m=(r(72160),r(40068),r(26816),r(63728),r(26560),r(23792),r(88700),r(70368),r(9024),r(64456),r(22156),r(42756),r(25288),r(38076),r(84244)),_=r(95548),g=r(90360),b=r(73844);r(61016),(0,k.c)([(0,_.Kx)("ha-hls-player")],(function(e,t){var k,w,x,I,E=function(t){function r(){var t;(0,h.c)(this,r);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return t=(0,u.c)(this,r,[].concat(i)),e((0,v.c)(t)),t}return(0,p.c)(r,t),(0,l.c)(r)}(t);return{F:E,d:[{kind:"field",decorators:[(0,_.qq)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,_.qq)()],key:"url",value:void 0},{kind:"field",decorators:[(0,_.qq)()],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,_.qq)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,_.qq)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,_.qq)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,_.qq)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,_.qq)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,_.kt)("video")],key:"_videoEl",value:void 0},{kind:"field",decorators:[(0,_.K2)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,_.K2)()],key:"_errorIsFatal",value:function(){return!1}},{kind:"field",key:"_hlsPolyfillInstance",value:void 0},{kind:"field",key:"_exoPlayer",value:function(){return!1}},{kind:"field",static:!0,key:"streamCount",value:function(){return 0}},{kind:"method",key:"connectedCallback",value:function(){(0,f.c)((0,y.c)(E.prototype),"connectedCallback",this).call(this),E.streamCount+=1,this.hasUpdated&&(this._resetError(),this._startHls())}},{kind:"method",key:"disconnectedCallback",value:function(){(0,f.c)((0,y.c)(E.prototype),"disconnectedCallback",this).call(this),E.streamCount-=1,this._cleanUp()}},{kind:"method",key:"render",value:function(){return(0,m.kP)(a||(a=(0,d.c)([" "," "," "])),this._error?(0,m.kP)(i||(i=(0,d.c)(['<ha-alert alert-type="error" class="','"> '," </ha-alert>"])),this._errorIsFatal?"fatal":"retry",this._error):"",this._errorIsFatal?"":(0,m.kP)(n||(n=(0,d.c)(['<video .poster="','" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" @loadeddata="','"></video>'])),this.posterUrl,this.autoPlay,this.muted,this.playsInline,this.controls,this._loadedData))}},{kind:"method",key:"updated",value:function(e){(0,f.c)((0,y.c)(E.prototype),"updated",this).call(this,e),e.has("url")&&(this._cleanUp(),this._resetError(),this._startHls())}},{kind:"method",key:"_startHls",value:(I=(0,c.c)((0,o.c)().mark((function e(){var t,a,i,n,s,c,d,l,h,u;return(0,o.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=fetch(this.url),e.next=3,Promise.all([r.e(8532),r.e(96996)]).then(r.bind(r,96996));case 3:if(i=e.sent.default,this.isConnected){e.next=6;break}return e.abrupt("return");case 6:if((n=i.isSupported())||(n=""!==this._videoEl.canPlayType("application/vnd.apple.mpegurl")),n){e.next=11;break}return this._setFatalError(this.hass.localize("ui.components.media-browser.video_not_supported")),e.abrupt("return");case 11:return s=this.allowExoPlayer&&(null===(t=this.hass.auth.external)||void 0===t?void 0:t.config.hasExoPlayer),e.next=14,a;case 14:return e.next=16,e.sent.text();case 16:if(c=e.sent,this.isConnected){e.next=19;break}return e.abrupt("return");case 19:l=(d=/#EXT-X-STREAM-INF:.*?(?:CODECS=".*?(hev1|hvc1)?\..*?".*?)?(?:\n|\r\n)(.+)/g).exec(c),h=d.exec(c),u=null!==l&&null===h?new URL(l[2],this.url).href:this.url,s&&null!==l&&void 0!==l[1]?this._renderHLSExoPlayer(u):i.isSupported()?this._renderHLSPolyfill(this._videoEl,i,u):this._renderHLSNative(this._videoEl,u);case 24:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{kind:"method",key:"_renderHLSExoPlayer",value:(x=(0,c.c)((0,o.c)().mark((function e(t){return(0,o.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._exoPlayer=!0,window.addEventListener("resize",this._resizeExoPlayer),this.updateComplete.then((function(){return(0,b.K)()})).then(this._resizeExoPlayer),this._videoEl.style.visibility="hidden",e.next=6,this.hass.auth.external.fireMessage({type:"exoplayer/play_hls",payload:{url:new URL(t,window.location.href).toString(),muted:this.muted}});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{kind:"field",key:"_resizeExoPlayer",value:function(){var e=this;return function(){if(e._videoEl){var t=e._videoEl.getBoundingClientRect();e.hass.auth.external.fireMessage({type:"exoplayer/resize",payload:{left:t.left,top:t.top,right:t.right,bottom:t.bottom}})}}}},{kind:"method",key:"_isLLHLSSupported",value:function(){if(E.streamCount<=2)return!0;if(!("performance"in window)||0===performance.getEntriesByType("resource").length)return!1;var e=performance.getEntriesByType("resource")[0];return"nextHopProtocol"in e&&"h2"===e.nextHopProtocol}},{kind:"method",key:"_renderHLSPolyfill",value:(w=(0,c.c)((0,o.c)().mark((function e(t,r,a){var i,n=this;return(0,o.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new r({backBufferLength:60,fragLoadingTimeOut:3e4,manifestLoadingTimeOut:3e4,levelLoadingTimeOut:3e4,maxLiveSyncPlaybackRate:2,lowLatencyMode:this._isLLHLSSupported()}),this._hlsPolyfillInstance=i,i.attachMedia(t),i.on(r.Events.MEDIA_ATTACHED,(function(){n._resetError(),i.loadSource(a)})),i.on(r.Events.FRAG_LOADED,(function(e,t){n._resetError()})),i.on(r.Events.ERROR,(function(e,t){if(t.fatal)if(t.type===r.ErrorTypes.NETWORK_ERROR){switch(t.details){case r.ErrorDetails.MANIFEST_LOAD_ERROR:var a="Error starting stream, see logs for details";void 0!==t.response&&void 0!==t.response.code&&(t.response.code>=500?a+=" (Server failure)":t.response.code>=400?a+=" (Stream never started)":a+=" ("+t.response.code+")"),n._setRetryableError(a);break;case r.ErrorDetails.MANIFEST_LOAD_TIMEOUT:n._setRetryableError("Timeout while starting stream");break;default:n._setRetryableError("Stream network error")}i.startLoad()}else t.type===r.ErrorTypes.MEDIA_ERROR?(n._setRetryableError("Error with media stream contents"),i.recoverMediaError()):n._setFatalError("Error playing stream")}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return w.apply(this,arguments)})},{kind:"method",key:"_renderHLSNative",value:(k=(0,c.c)((0,o.c)().mark((function e(t,r){return(0,o.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.src=r,t.addEventListener("loadedmetadata",(function(){t.play()}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return k.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){this._hlsPolyfillInstance&&(this._hlsPolyfillInstance.destroy(),this._hlsPolyfillInstance=void 0),this._exoPlayer&&(window.removeEventListener("resize",this._resizeExoPlayer),this.hass.auth.external.fireMessage({type:"exoplayer/stop"}),this._exoPlayer=!1),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load())}},{kind:"method",key:"_resetError",value:function(){this._error=void 0,this._errorIsFatal=!1}},{kind:"method",key:"_setFatalError",value:function(e){this._error=e,this._errorIsFatal=!0}},{kind:"method",key:"_setRetryableError",value:function(e){this._error=e,this._errorIsFatal=!1}},{kind:"method",key:"_loadedData",value:function(){(0,g.O)(this,"load")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,m.gV)(s||(s=(0,d.c)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}.fatal{display:block;padding:100px 16px}.retry{display:block}"])))}}]}}),m.oH)},75244:function(e,t,r){r.d(t,{s:function(){return a}});r(40068);var a=function(e){return"/api/image_proxy/".concat(e.entity_id,"?token=").concat(e.attributes.access_token,"&state=").concat(e.state)}},26368:function(e,t,r){var a,i,n,s,o,c,d=r(95892),l=r(48328),h=r(76904),u=r(9160),v=r(45472),p=r(72696),k=r(88584),f=r(96440),y=r(19612),m=r(37668),_=r(54915),g=(r(40068),r(74339),r(69592),r(48996),r(63728),r(49704),r(53904),r(90629),r(84244)),b=r(95548),w=r(52672),x=r(83120),I=r(65212),E=r(85860),C=r(21164),q=(r(59672),r(59781),r(68324)),S=r(15695),P=r(75244),O=function(e){return e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error",e}(O||{});(0,y.c)([(0,b.Kx)("hui-image")],(function(e,t){var r,y,L,U,R=function(t){function r(){var t;(0,v.c)(this,r);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return t=(0,p.c)(this,r,[].concat(i)),e((0,k.c)(t)),t}return(0,f.c)(r,t),(0,u.c)(r)}(t);return{F:R,d:[{kind:"field",decorators:[(0,b.qq)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"image",value:void 0},{kind:"field",decorators:[(0,b.qq)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,b.qq)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,b.qq)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,b.K2)()],key:"_imageVisible",value:function(){return!1}},{kind:"field",decorators:[(0,b.K2)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,b.K2)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,b.K2)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,b.K2)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:function(){return null}},{kind:"method",key:"connectedCallback",value:function(){(0,m.c)((0,_.c)(R.prototype),"connectedCallback",this).call(this),void 0===this._loadState&&(this._loadState=O.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,m.c)((0,_.c)(R.prototype),"disconnectedCallback",this).call(this),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(e){if(e.has("hass")){var t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=O.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,C.c)(this.aspectRatio):null),this._loadState!==O.Loading||this.cameraImage||(this._loadState=O.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return g.qs;var e,t,r=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),c=this.entity?this.hass.states[this.entity]:void 0,d=c?c.state:S.YV,l=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?t=this.hass.states[this.cameraImage]:e=this._cameraImageSrc;else if(this.stateImage){var u=this.stateImage[d];u?e=u:(e=this.image,l=!0)}else e=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:c&&"image"===(0,E.o)(c.entity_id)?(0,P.s)(c):this.image;e&&(e=this.hass.hassUrl(e));var v=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(v+=this.darkModeFilter),this.stateFilter&&this.stateFilter[d]&&(v+=this.stateFilter[d]),!v&&this.entity)&&(v=(!c||I.CU.includes(d))&&l?"grayscale(100%)":"");return(0,g.kP)(a||(a=(0,h.c)([' <div style="','" class="container ','"> '," "," </div> "])),(0,x.C)({paddingBottom:r?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:r&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:this._loadState===O.Loaded||"live"===this.cameraView?v:void 0}),(0,w.m)({ratio:r||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,g.kP)(i||(i=(0,h.c)([' <ha-camera-stream muted .hass="','" .stateObj="','" @load="','"></ha-camera-stream> '])),this.hass,t,this._onVideoLoad):void 0===e?g.qs:(0,g.kP)(n||(n=(0,h.c)([' <img id="image" src="','" @error="','" @load="','" style="','"> '])),e,this._onImageError,this._onImageLoad,(0,x.C)({display:r||this._loadState===O.Loaded?"block":"none"})),this._loadState===O.Error?(0,g.kP)(s||(s=(0,h.c)(['<div id="brokenImage" style="','"></div>'])),(0,x.C)({height:r?void 0:"".concat(this._lastImageHeight,"px")||0})):"live"===this.cameraView||void 0!==e&&this._loadState!==O.Loading?"":(0,g.kP)(o||(o=(0,h.c)(['<div class="progress-container" style="','"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>'])),(0,x.C)({height:r?void 0:"".concat(this._lastImageHeight,"px")||0})))}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){var e=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((function(){return e._updateCameraImageSrcAtInterval()}),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=O.Error}},{kind:"method",key:"_onImageLoad",value:(U=(0,l.c)((0,d.c)().mark((function e(t){var r;return(0,d.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=O.Loaded,r=t.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=r.src),e.next=5,this.updateComplete;case 5:this._lastImageHeight=r.offsetHeight;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{kind:"method",key:"_onVideoLoad",value:(L=(0,l.c)((0,d.c)().mark((function e(t){var r;return(0,d.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=O.Loaded,r=t.currentTarget,e.next=4,this.updateComplete;case 4:this._lastImageHeight=r.offsetHeight;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:(y=(0,l.c)((0,d.c)().mark((function e(){return(0,d.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState===O.Loading&&this._onImageError(),e.abrupt("return",this._updateCameraImageSrc());case 2:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrc",value:(r=(0,l.c)((0,d.c)().mark((function e(){var t,r,a;return(0,d.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hass&&this.cameraImage){e.next=2;break}return e.abrupt("return");case 2:if(this.hass.states[this.cameraImage]){e.next=6;break}return this._onImageError(),e.abrupt("return");case 6:return t=this.clientWidth||640,r=Math.ceil(t*devicePixelRatio),this._lastImageHeight?a=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?a=Math.ceil(r*(this._ratio.h/this._ratio.w)):(r*=2,a=Math.ceil(.5625*r)),e.next=11,(0,q.od)(this.hass,this.cameraImage,r,a);case 11:this._cameraImageSrc=e.sent,void 0===this._cameraImageSrc&&this._onImageError();case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,g.gV)(c||(c=(0,h.c)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}'])))}}]}}),g.oH)}}]);
//# sourceMappingURL=26368.NCMrl2-qN94.js.map