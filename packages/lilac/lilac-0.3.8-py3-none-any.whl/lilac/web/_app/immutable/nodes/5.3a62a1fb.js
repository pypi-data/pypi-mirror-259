import{S as be,i as he,s as we,k as y,a as A,l as R,m as C,c as U,h as _,n as q,b as I,U as T,g as k,v as K,d as D,f as G,H as X,y as J,z as M,A as z,B as j,q as F,e as te,r as P,u as Y,V as x,aa as ee,w as Ee,J as Te,K as $e}from"../chunks/index.cbae6e09.js";import{b as Ve,P as Ne}from"../chunks/Page.c8a3df22.js";import{g as ye}from"../chunks/navigation.fe22b4d6.js";import{e as Re,R as Ce}from"../chunks/DatasetSettingsFields.f206bf35.js";import{b2 as Fe,g as Pe,bg as qe,bd as Le,q as Oe,ai as He,a4 as Be,a5 as Ae,a6 as Ue,aW as We,ag as oe,aj as Je,an as Me,E as ze,al as je,am as Ke,D as Ge,a8 as Xe,c as Ye}from"../chunks/Modal.54eb1296.js";import{T as ve}from"../chunks/ToastNotification.82e8a3ac.js";function fe(l){let s,t;return s=new ve({props:{hideCloseButton:!0,kind:"warning",fullWidth:!0,lowContrast:!0,title:"Unknown task",caption:"This could be from a stale link, or a new server instance."}}),{c(){J(s.$$.fragment)},l(e){M(s.$$.fragment,e)},m(e,i){z(s,e,i),t=!0},i(e){t||(k(s.$$.fragment,e),t=!0)},o(e){D(s.$$.fragment,e),t=!1},d(e){j(s,e)}}}function ue(l){let s,t,e,i,n,a,u,o,r,b,c,h,w,$,V,f=l[3].status==="error"&&de(l),d=l[3].status!="error"&&ce(l);const p=[Qe,Ze],g=[];function N(m,v){return m[3].status=="completed"?0:m[3].status==="error"?1:-1}return~(h=N(l))&&(w=g[h]=p[h](l)),{c(){s=y("section"),t=y("div"),e=F('Step 1: Load dataset "'),i=F(l[0]),n=F("/"),a=F(l[1]),u=F('"'),o=A(),r=y("div"),f&&f.c(),b=A(),d&&d.c(),c=A(),w&&w.c(),$=te(),this.h()},l(m){s=R(m,"SECTION",{class:!0});var v=C(s);t=R(v,"DIV",{class:!0});var E=C(t);e=P(E,'Step 1: Load dataset "'),i=P(E,l[0]),n=P(E,"/"),a=P(E,l[1]),u=P(E,'"'),E.forEach(_),o=U(v),r=R(v,"DIV",{class:!0});var W=C(r);f&&f.l(W),W.forEach(_),b=U(v),d&&d.l(v),v.forEach(_),c=U(m),w&&w.l(m),$=te(),this.h()},h(){q(t,"class","text-2xl text-gray-700"),q(r,"class","text-base"),q(s,"class","flex flex-col gap-y-2")},m(m,v){I(m,s,v),T(s,t),T(t,e),T(t,i),T(t,n),T(t,a),T(t,u),T(s,o),T(s,r),f&&f.m(r,null),T(s,b),d&&d.m(s,null),I(m,c,v),~h&&g[h].m(m,v),I(m,$,v),V=!0},p(m,v){(!V||v&1)&&Y(i,m[0]),(!V||v&2)&&Y(a,m[1]),m[3].status==="error"?f?f.p(m,v):(f=de(m),f.c(),f.m(r,null)):f&&(f.d(1),f=null),m[3].status!="error"?d?(d.p(m,v),v&8&&k(d,1)):(d=ce(m),d.c(),k(d,1),d.m(s,null)):d&&(K(),D(d,1,1,()=>{d=null}),G());let E=h;h=N(m),h===E?~h&&g[h].p(m,v):(w&&(K(),D(g[E],1,1,()=>{g[E]=null}),G()),~h?(w=g[h],w?w.p(m,v):(w=g[h]=p[h](m),w.c()),k(w,1),w.m($.parentNode,$)):w=null)},i(m){V||(k(d),k(w),V=!0)},o(m){D(d),D(w),V=!1},d(m){m&&_(s),f&&f.d(),d&&d.d(),m&&_(c),~h&&g[h].d(m),m&&_($)}}}function de(l){let s,t,e,i;return{c(){s=F("Error loading "),t=F(l[0]),e=F("/"),i=F(l[1])},l(n){s=P(n,"Error loading "),t=P(n,l[0]),e=P(n,"/"),i=P(n,l[1])},m(n,a){I(n,s,a),I(n,t,a),I(n,e,a),I(n,i,a)},p(n,a){a&1&&Y(t,n[0]),a&2&&Y(i,n[1])},d(n){n&&_(s),n&&_(t),n&&_(e),n&&_(i)}}}function ce(l){var u,o;let s,t,e,i,n;t=new Ve({props:{labelText:l[3].message||"",helperText:l[3].status!="completed"?l[3].details||void 0:"",value:l[3].status==="completed"?1:l[6],max:1,status:l[18][l[3].status]}});let a=((o=(u=l[5])==null?void 0:u.data)==null?void 0:o.total_num_rows)!=null&&me(l);return{c(){s=y("div"),J(t.$$.fragment),e=A(),i=y("div"),a&&a.c(),this.h()},l(r){s=R(r,"DIV",{class:!0});var b=C(s);M(t.$$.fragment,b),b.forEach(_),e=U(r),i=R(r,"DIV",{class:!0});var c=C(i);a&&a.l(c),c.forEach(_),this.h()},h(){q(s,"class","mt-2"),q(i,"class","text-sm text-gray-700")},m(r,b){I(r,s,b),z(t,s,null),I(r,e,b),I(r,i,b),a&&a.m(i,null),n=!0},p(r,b){var h,w;const c={};b&8&&(c.labelText=r[3].message||""),b&8&&(c.helperText=r[3].status!="completed"?r[3].details||void 0:""),b&72&&(c.value=r[3].status==="completed"?1:r[6]),b&8&&(c.status=r[18][r[3].status]),t.$set(c),((w=(h=r[5])==null?void 0:h.data)==null?void 0:w.total_num_rows)!=null?a?a.p(r,b):(a=me(r),a.c(),a.m(i,null)):a&&(a.d(1),a=null)},i(r){n||(k(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&_(s),j(t),r&&_(e),r&&_(i),a&&a.d()}}}function me(l){var i,n;let s=((n=(i=l[5])==null?void 0:i.data)==null?void 0:n.total_num_rows.toLocaleString())+"",t,e;return{c(){t=F(s),e=F(" rows loaded")},l(a){t=P(a,s),e=P(a," rows loaded")},m(a,u){I(a,t,u),I(a,e,u)},p(a,u){var o,r;u&32&&s!==(s=((r=(o=a[5])==null?void 0:o.data)==null?void 0:r.total_num_rows.toLocaleString())+"")&&Y(t,s)},d(a){a&&_(t),a&&_(e)}}}function Ze(l){let s,t;return s=new ve({props:{hideCloseButton:!0,kind:"error",fullWidth:!0,lowContrast:!0,title:"Error loading dataset",caption:l[3].error||void 0}}),{c(){J(s.$$.fragment)},l(e){M(s.$$.fragment,e)},m(e,i){z(s,e,i),t=!0},p(e,i){const n={};i&8&&(n.caption=e[3].error||void 0),s.$set(n)},i(e){t||(k(s.$$.fragment,e),t=!0)},o(e){D(s.$$.fragment,e),t=!1},d(e){j(s,e)}}}function Qe(l){let s,t,e,i,n,a,u,o,r,b,c,h,w,$,V,f=l[2]&&_e(l),d=l[9]!=null&&pe(l);return $=new Ge({props:{disabled:l[2]==null,size:"xl",icon:Xe,iconDescription:"Open dataset",$$slots:{default:[xe]},$$scope:{ctx:l}}}),$.$on("click",l[27]),{c(){s=y("div"),t=y("section"),e=y("div"),i=y("div"),n=F("Step 2: Choose settings"),a=A(),u=y("div"),o=F("These settings can be changed from the dataset page at any time."),r=A(),f&&f.c(),b=A(),c=y("div"),d&&d.c(),h=A(),w=y("div"),J($.$$.fragment),this.h()},l(p){s=R(p,"DIV",{class:!0});var g=C(s);t=R(g,"SECTION",{class:!0});var N=C(t);e=R(N,"DIV",{class:!0});var m=C(e);i=R(m,"DIV",{class:!0});var v=C(i);n=P(v,"Step 2: Choose settings"),v.forEach(_),a=U(m),u=R(m,"DIV",{class:!0});var E=C(u);o=P(E,"These settings can be changed from the dataset page at any time."),E.forEach(_),m.forEach(_),r=U(N),f&&f.l(N),N.forEach(_),g.forEach(_),b=U(p),c=R(p,"DIV",{});var W=C(c);d&&d.l(W),W.forEach(_),h=U(p),w=R(p,"DIV",{class:!0});var Z=C(w);M($.$$.fragment,Z),Z.forEach(_),this.h()},h(){q(i,"class","text-2xl text-gray-700"),q(u,"class","text-sm text-gray-500"),q(e,"class","flex flex-col gap-y-2"),q(t,"class","flex flex-col gap-y-4"),q(s,"class","my-8"),q(w,"class","dataset-link mt-8")},m(p,g){I(p,s,g),T(s,t),T(t,e),T(e,i),T(i,n),T(e,a),T(e,u),T(u,o),T(t,r),f&&f.m(t,null),I(p,b,g),I(p,c,g),d&&d.m(c,null),I(p,h,g),I(p,w,g),z($,w,null),V=!0},p(p,g){p[2]?f?(f.p(p,g),g&4&&k(f,1)):(f=_e(p),f.c(),k(f,1),f.m(t,null)):f&&(K(),D(f,1,1,()=>{f=null}),G()),p[9]!=null?d?(d.p(p,g),g&512&&k(d,1)):(d=pe(p),d.c(),k(d,1),d.m(c,null)):d&&(K(),D(d,1,1,()=>{d=null}),G());const N={};g&4&&(N.disabled=p[2]==null),g&1073741824&&(N.$$scope={dirty:g,ctx:p}),$.$set(N)},i(p){V||(k(f),k(d),k($.$$.fragment,p),V=!0)},o(p){D(f),D(d),D($.$$.fragment,p),V=!1},d(p){p&&_(s),f&&f.d(),p&&_(b),p&&_(c),d&&d.d(),p&&_(h),p&&_(w),j($)}}}function _e(l){let s,t,e;function i(a){l[26](a)}let n={namespace:l[0],datasetName:l[1]};return l[2]!==void 0&&(n.newSettings=l[2]),s=new Re({props:n}),Ee.push(()=>Te(s,"newSettings",i)),{c(){J(s.$$.fragment)},l(a){M(s.$$.fragment,a)},m(a,u){z(s,a,u),e=!0},p(a,u){const o={};u&1&&(o.namespace=a[0]),u&2&&(o.datasetName=a[1]),!t&&u&4&&(t=!0,o.newSettings=a[2],$e(()=>t=!1)),s.$set(o)},i(a){e||(k(s.$$.fragment,a),e=!0)},o(a){D(s.$$.fragment,a),e=!1},d(a){j(s,a)}}}function pe(l){var a,u;let s,t,e,i,n;return i=new Ce({props:{rowId:l[9],index:0,totalNumRows:(u=(a=l[5])==null?void 0:a.data)==null?void 0:u.total_num_rows,mediaFields:l[7],highlightedFields:l[8],datasetViewHeight:320}}),{c(){s=y("div"),t=F("Preview"),e=A(),J(i.$$.fragment),this.h()},l(o){s=R(o,"DIV",{class:!0});var r=C(s);t=P(r,"Preview"),r.forEach(_),e=U(o),M(i.$$.fragment,o),this.h()},h(){q(s,"class","mb-2 text-xl text-gray-700")},m(o,r){I(o,s,r),T(s,t),I(o,e,r),z(i,o,r),n=!0},p(o,r){var c,h;const b={};r&512&&(b.rowId=o[9]),r&32&&(b.totalNumRows=(h=(c=o[5])==null?void 0:c.data)==null?void 0:h.total_num_rows),r&128&&(b.mediaFields=o[7]),r&256&&(b.highlightedFields=o[8]),i.$set(b)},i(o){n||(k(i.$$.fragment,o),n=!0)},o(o){D(i.$$.fragment,o),n=!1},d(o){o&&_(s),o&&_(e),j(i,o)}}}function xe(l){let s;return{c(){s=F("Save and open dataset")},l(t){s=P(t,"Save and open dataset")},m(t,e){I(t,s,e)},d(t){t&&_(s)}}}function et(l){let s,t,e,i,n=l[4].isSuccess&&l[3]==null&&fe(),a=l[3]&&ue(l);return{c(){s=y("div"),t=y("div"),n&&n.c(),e=A(),a&&a.c(),this.h()},l(u){s=R(u,"DIV",{class:!0});var o=C(s);t=R(o,"DIV",{class:!0});var r=C(t);n&&n.l(r),e=U(r),a&&a.l(r),r.forEach(_),o.forEach(_),this.h()},h(){q(t,"class","center-panel mx-auto p-8 svelte-af9918"),q(s,"class","w-full overflow-y-scroll")},m(u,o){I(u,s,o),T(s,t),n&&n.m(t,null),T(t,e),a&&a.m(t,null),i=!0},p(u,[o]){u[4].isSuccess&&u[3]==null?n?o&24&&k(n,1):(n=fe(),n.c(),k(n,1),n.m(t,e)):n&&(K(),D(n,1,1,()=>{n=null}),G()),u[3]?a?(a.p(u,o),o&8&&k(a,1)):(a=ue(u),a.c(),k(a,1),a.m(t,null)):a&&(K(),D(a,1,1,()=>{a=null}),G())},i(u){i||(k(n),k(a),i=!0)},o(u){D(n),D(a),i=!1},d(u){u&&_(s),n&&n.d(),a&&a.d()}}}function tt(l,s,t){let e,i,n,a,u,o,r,b,c,h,w,$,V,f,d=x,p=()=>(d(),d=ee(n,S=>t(22,f=S)),n),g,N=x,m=()=>(N(),N=ee(a,S=>t(23,g=S)),a),v,E,W=x,Z=()=>(W(),W=ee(u,S=>t(5,E=S)),u),L,se=x,ke=()=>(se(),se=ee(i,S=>t(25,L=S)),i);l.$$.on_destroy.push(()=>d()),l.$$.on_destroy.push(()=>N()),l.$$.on_destroy.push(()=>W()),l.$$.on_destroy.push(()=>se());let{namespace:O}=s,{datasetName:H}=s,{loadingTaskId:Q}=s,B;const ae=Fe();X(l,ae,S=>t(29,$=S));const ie=Pe();X(l,ie,S=>t(28,w=S));const le=qe(O,H);X(l,le,S=>t(24,v=S)),Le(le);const ne=Oe();X(l,ne,S=>t(4,V=S));const Se={pending:"active",completed:"finished",error:"error"};function re(){B!=null&&$.mutate([O,H,B],{onSuccess:()=>{ye(ze(O,H,w))}})}function Ie(S){B=S,t(2,B),t(25,L)}const De=()=>re();return l.$$set=S=>{"namespace"in S&&t(0,O=S.namespace),"datasetName"in S&&t(1,H=S.datasetName),"loadingTaskId"in S&&t(20,Q=S.loadingTaskId)},l.$$.update=()=>{l.$$.dirty&1048592&&t(3,c=Q!=null&&V.data!=null?V.data.tasks[Q]:null),l.$$.dirty&8&&t(21,e=(c==null?void 0:c.status)=="completed"),l.$$.dirty&2097155&&ke(t(13,i=e?He(O,H):null)),l.$$.dirty&33554436&&t(2,B=L!=null&&L.isFetching||(L==null?void 0:L.data)==null?null:B??JSON.parse(JSON.stringify(L==null?void 0:L.data))),l.$$.dirty&2097155&&p(t(12,n=e?Be(O,H):null)),l.$$.dirty&23068675&&m(t(11,a=e?Ae(O,H,Ue(v,f==null?void 0:f.data)):null)),l.$$.dirty&4194307&&Z(t(10,u=O&&H&&(f==null?void 0:f.data)!=null?We(O,H,{columns:[oe],limit:1,combine_columns:!0},f.data):null)),l.$$.dirty&32&&t(9,o=(E==null?void 0:E.data)!=null?je.value(Ke(E.data.rows[0],[oe]),"string"):null),l.$$.dirty&25165824&&t(8,r=Je(v.query,g==null?void 0:g.data)),l.$$.dirty&4194308&&t(7,b=B!=null&&(f==null?void 0:f.data)!=null?Me(f==null?void 0:f.data,B):[]),l.$$.dirty&8&&t(6,h=(c==null?void 0:c.total_progress)!=null&&(c==null?void 0:c.total_len)!=null?c.total_progress/c.total_len:void 0)},[O,H,B,c,V,E,h,b,r,o,u,a,n,i,ae,ie,le,ne,Se,re,Q,e,f,g,v,L,Ie,De]}class st extends be{constructor(s){super(),he(this,s,tt,et,we,{namespace:0,datasetName:1,loadingTaskId:20})}}function ge(l){let s,t;return s=new st({props:{namespace:l[0],datasetName:l[1],loadingTaskId:l[2]}}),{c(){J(s.$$.fragment)},l(e){M(s.$$.fragment,e)},m(e,i){z(s,e,i),t=!0},p(e,i){const n={};i&1&&(n.namespace=e[0]),i&2&&(n.datasetName=e[1]),i&4&&(n.loadingTaskId=e[2]),s.$set(n)},i(e){t||(k(s.$$.fragment,e),t=!0)},o(e){D(s.$$.fragment,e),t=!1},d(e){j(s,e)}}}function lt(l){let s,t,e=l[0]!=null&&l[1]!=null&&l[2]!=null&&ge(l);return{c(){e&&e.c(),s=te()},l(i){e&&e.l(i),s=te()},m(i,n){e&&e.m(i,n),I(i,s,n),t=!0},p(i,n){i[0]!=null&&i[1]!=null&&i[2]!=null?e?(e.p(i,n),n&7&&k(e,1)):(e=ge(i),e.c(),k(e,1),e.m(s.parentNode,s)):e&&(K(),D(e,1,1,()=>{e=null}),G())},i(i){t||(k(e),t=!0)},o(i){D(e),t=!1},d(i){e&&e.d(i),i&&_(s)}}}function at(l){let s,t;return s=new Ne({props:{$$slots:{default:[lt]},$$scope:{ctx:l}}}),{c(){J(s.$$.fragment)},l(e){M(s.$$.fragment,e)},m(e,i){z(s,e,i),t=!0},p(e,[i]){const n={};i&39&&(n.$$scope={dirty:i,ctx:e}),s.$set(n)},i(e){t||(k(s.$$.fragment,e),t=!0)},o(e){D(s.$$.fragment,e),t=!1},d(e){j(s,e)}}}function it(l,s,t){let e,i,n,a;const u=Ye();return X(l,u,o=>t(4,e=o)),l.$$.update=()=>{l.$$.dirty&16&&e.page==="datasets/loading"&&e.identifier!=null&&t(0,[i,n,a]=e.identifier.split("/"),i,(t(1,n),t(4,e)),(t(2,a),t(4,e)))},[i,n,a,u,e]}class ct extends be{constructor(s){super(),he(this,s,it,at,we,{})}}export{ct as component};
